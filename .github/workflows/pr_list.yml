name: List of Pull Requests

on:
    push:
        branches:
            main

    workflow_dispatch:

jobs:
    list_of_PRs:
        runs-on: [ubuntu-latest]

        steps:
            - name: Checkout repository
              uses: actions/checkout@v2
              with:
                ref: ${{ github.ref }}
                
            - name: Authenticating for GitHub
              env:
               STAGE: dev
               GH_PAT: ${{ secrets.TOKEN_GITHUB }}
              run: |
                gh auth login --with-token <<<"${{ secrets.GH_PAT }}"
                gh pr list --author sqali > pull_requests_list.txt
                cat pull_requests_list.txt

            - name: Upload a Build Artifact
              uses: actions/upload-artifact@v3.1.3
              with:
                name: pull_requests_list
                path: pull_requests_list.txt
        
        # Checkout the code and use the python file to filter out the PR list
